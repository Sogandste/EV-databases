<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Database Functional Heatmap 2025</title>
    <!-- Library for screen capture -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --color-high: #002147; /* Navy Blue - Score 3 */
            --color-mid: #228B22;  /* Forest Green - Score 2 */
            --color-basic: #90A4AE; /* Grey Blue - Score 1 */
            --color-none: #ECEFF1; /* Light Gray - Score 0 */
            --bg-color: #f4f6f8;
            --text-color: #333;
            --font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 1300px;
            width: 100%;
            overflow-x: auto; /* Prevent cut-off on small screens */
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 26px;
            margin-bottom: 8px;
            color: var(--color-high);
        }

        p.subtitle {
            color: #666;
            font-size: 15px;
            margin-top: 0;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 10px 20px;
            border: 2px solid var(--color-high);
            background: white;
            color: var(--color-high);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .btn:hover, .btn.active {
            background: var(--color-high);
            color: white;
            box-shadow: 0 4px 10px rgba(0,33,71, 0.3);
        }

        .btn-download {
            background: #2196F3;
            border-color: #2196F3;
            color: white;
        }
        .btn-download:hover {
            background: #1976D2;
            border-color: #1976D2;
        }

        /* Heatmap Grid Layout */
        .heatmap-wrapper {
            /* This wrapper is what we will capture */
            padding: 20px;
            background: white; 
        }

        .heatmap-grid {
            display: grid;
            /* First col 200px, then 7 equal columns */
            grid-template-columns: 220px repeat(7, 1fr); 
            gap: 6px; 
            margin-bottom: 20px;
            align-items: center;
        }

        /* Headers */
        .col-header {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            text-align: center;
            color: #444;
            padding-bottom: 10px;
            display: flex;
            align-items: flex-end; /* Align text to bottom */
            justify-content: center;
            height: 100px; /* Tall enough for rotation */
            border-bottom: 2px solid #eee;
            margin-bottom: 10px;
        }

        .col-header span {
            /* No rotation for better readability, or slight rotation if needed */
            /* transform: rotate(-45deg); */
            text-align: center;
            white-space: normal; /* Allow wrapping */
            line-height: 1.2;
        }

        .row-label {
            font-weight: 700;
            font-size: 14px;
            color: #333;
            text-align: right;
            padding-right: 20px;
            white-space: nowrap;
        }

        /* Cells */
        .cell {
            height: 45px;
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 14px;
            font-weight: bold;
            position: relative;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.1);
        }

        /* Colors */
        .score-0 { background-color: var(--color-none); color: #bbb; }
        .score-1 { background-color: var(--color-basic); color: white; }
        .score-2 { background-color: var(--color-mid); }
        .score-3 { background-color: var(--color-high); }

        /* Tooltip */
        .cell:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10;
            pointer-events: none;
            margin-bottom: 6px;
            font-weight: normal;
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 30px;
            font-size: 13px;
            color: #555;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        /* Cluster Divider */
        .cluster-divider {
            grid-column: 1 / -1; /* Span full width */
            background-color: #f0f2f5;
            color: #555;
            font-weight: 800;
            font-size: 13px;
            padding: 8px 15px;
            margin-top: 10px;
            margin-bottom: 5px;
            border-radius: 6px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            border-left: 5px solid var(--color-high);
        }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Functional Assessment of EV Databases (2025)</h1>
        <p class="subtitle">Scenario-Based Functional Heatmap: Comparing 15 Key Resources</p>
    </header>

    <div class="controls">
        <button class="btn active" onclick="sortData('cluster')">View by Cluster</button>
        <button class="btn" onclick="sortData('score')">Sort by Total Score</button>
        <button class="btn" onclick="sortData('name')">Sort A-Z</button>
        <button class="btn btn-download" onclick="downloadImage()">Download Image</button>
    </div>

    <!-- The area to be captured -->
    <div class="heatmap-wrapper" id="captureArea">
        <div class="heatmap-grid" id="grid">
            <!-- JS populates this -->
        </div>
        
        <div class="legend">
            <div class="legend-item"><div class="legend-box score-0"></div> N/A (0)</div>
            <div class="legend-item"><div class="legend-box score-1"></div> Basic (1)</div>
            <div class="legend-item"><div class="legend-box score-2"></div> Moderate (2)</div>
            <div class="legend-item"><div class="legend-box score-3"></div> Advanced / Specialized (3)</div>
        </div>
    </div>
</div>

<script>
    const databases = [
        // Cluster 1
        { name: "Vesiclepedia", cluster: "I. Foundational Pillars", scores: [3, 3, 1, 3, 0, 1, 1] },
        { name: "ExoCarta",     cluster: "I. Foundational Pillars", scores: [3, 2, 1, 3, 0, 2, 1] },
        
        // Cluster 2
        { name: "exoRBase",     cluster: "II. RNA & Diagnostic Hubs", scores: [2, 1, 2, 2, 2, 3, 1] },
        { name: "ExoBCD",       cluster: "II. RNA & Diagnostic Hubs", scores: [2, 1, 3, 2, 0, 2, 0] },
        { name: "EVmiRNA",      cluster: "II. RNA & Diagnostic Hubs", scores: [1, 1, 3, 2, 1, 3, 1] },
        { name: "miREV",        cluster: "II. RNA & Diagnostic Hubs", scores: [1, 1, 1, 3, 1, 3, 0] },
        { name: "ExMdb",        cluster: "II. RNA & Diagnostic Hubs", scores: [1, 1, 3, 2, 2, 3, 0] },
        { name: "EVAtlas",      cluster: "II. RNA & Diagnostic Hubs", scores: [1, 1, 2, 2, 1, 2, 0] },
        { name: "EVLncRNAs",    cluster: "II. RNA & Diagnostic Hubs", scores: [1, 3, 2, 3, 1, 2, 1] },

        // Cluster 3
        { name: "SVAtlas",      cluster: "III. Next-Gen Context-Aware", scores: [3, 1, 2, 2, 3, 2, 0] },
        { name: "TcEVdb",       cluster: "III. Next-Gen Context-Aware", scores: [1, 1, 2, 2, 3, 3, 0] },
        { name: "EV-COMM",      cluster: "III. Next-Gen Context-Aware", scores: [0, 2, 1, 3, 3, 1, 0] },
        { name: "EVPsort",      cluster: "III. Next-Gen Context-Aware", scores: [1, 2, 2, 3, 2, 3, 0] },
        
        // Cluster 4
        { name: "EV-ADD",       cluster: "IV. Specialized / Utility", scores: [1, 1, 2, 1, 0, 0, 0] },
        { name: "EV-TRACK",     cluster: "IV. Specialized / Utility", scores: [0, 0, 0, 3, 0, 2, 1] },
    ];

    const columns = [
        "Content Breadth (Multi-Omics)",
        "Species Coverage",
        "Clinical / Disease Focus",
        "Metadata Quality (MISEV)",
        "Resolution (Single/Net)",
        "Analysis Tools",
        "API / Accessibility"
    ];

    const grid = document.getElementById('grid');

    function renderHeatmap(data, groupByCluster) {
        grid.innerHTML = '';

        // 1. Render Column Headers
        const corner = document.createElement('div');
        grid.appendChild(corner); // Top-left blank space

        columns.forEach(col => {
            const div = document.createElement('div');
            div.className = 'col-header';
            div.innerHTML = `<span>${col}</span>`;
            grid.appendChild(div);
        });

        let lastCluster = null;

        // 2. Render Rows
        data.forEach(db => {
            // Check if we need a cluster divider
            if (groupByCluster) {
                if (db.cluster !== lastCluster) {
                    lastCluster = db.cluster;
                    const divider = document.createElement('div');
                    divider.className = 'cluster-divider';
                    divider.innerText = lastCluster;
                    grid.appendChild(divider);
                }
            }

            // DB Name Row Label
            const label = document.createElement('div');
            label.className = 'row-label';
            label.innerText = db.name;
            grid.appendChild(label);

            // DB Score Cells
            db.scores.forEach((score, index) => {
                const cell = document.createElement('div');
                cell.className = `cell score-${score}`;
                cell.innerText = score > 0 ? score : '-';
                
                // Set tooltip text
                let tip = columns[index] + ": ";
                if(score===3) tip += "Advanced/High";
                else if(score===2) tip += "Moderate";
                else if(score===1) tip += "Basic";
                else tip += "N/A";
                
                cell.setAttribute('data-tooltip', tip);
                grid.appendChild(cell);
            });
        });
    }

    function sortData(type) {
        // Handle Button States
        document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
        // Identify which button was clicked (rough logic)
        const buttons = document.querySelectorAll('.btn');
        if(type==='cluster') buttons[0].classList.add('active');
        if(type==='score') buttons[1].classList.add('active');
        if(type==='name') buttons[2].classList.add('active');

        let sorted = [...databases];

        if (type === 'cluster') {
            // Already sorted by cluster in array definition, just need to render with grouping enabled
            renderHeatmap(sorted, true);
        } else if (type === 'score') {
            // Sort by sum of scores
            sorted.sort((a, b) => {
                const sumA = a.scores.reduce((acc, c) => acc + c, 0);
                const sumB = b.scores.reduce((acc, c) => acc + c, 0);
                return sumB - sumA;
            });
            renderHeatmap(sorted, false); // No cluster dividers
        } else if (type === 'name') {
            sorted.sort((a, b) => a.name.localeCompare(b.name));
            renderHeatmap(sorted, false); // No cluster dividers
        }
    }

    function downloadImage() {
        const element = document.getElementById("captureArea");
        
        // Hide tooltips before capture just in case
        // html2canvas options
        html2canvas(element, {
            backgroundColor: "#ffffff",
            scale: 2 // High resolution (Retina)
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'EV_Database_Heatmap_2025.png';
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }

    // Initial Load
    renderHeatmap(databases, true);

</script>

</body>
</html>