<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ app_name }} | Scientific Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --navy: #0b2545;
            --green: #1f6f54;
            --bg: #f4f6f8;
            --text-dark: #1a202c;
            --text-light: #718096;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            margin: 0; padding: 0;
            color: var(--text-dark);
            display: flex; flex-direction: column; min-height: 100vh;
        }

        .header {
            background: var(--navy);
            color: white;
            padding: 40px 20px;
            text-align: center;
            border-bottom: 4px solid var(--green);
        }

        .logo-box {
            width: 60px; height: 60px;
            background: var(--green);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; color: white;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
            animation: glow 3s infinite;
        }
        @keyframes glow { 0%,100% { box-shadow: 0 0 5px #1f6f54; } 50% { box-shadow: 0 0 20px #ffd700; } }

        .search-area {
            max-width: 800px; margin: -25px auto 30px;
            background: white; padding: 15px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            display: flex; gap: 10px;
        }

        input {
            flex: 1; padding: 12px 15px;
            border: 1px solid #e2e8f0; border-radius: 6px;
            font-size: 1rem; outline: none;
        }
        input:focus { border-color: var(--green); }

        button {
            background: var(--navy); color: white;
            border: none; padding: 0 30px; border-radius: 6px;
            font-weight: 600; cursor: pointer;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; flex: 1; }

        table {
            width: 100%; border-collapse: separate; border-spacing: 0;
            background: white; border-radius: 8px; overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        th {
            background: #edf2f7; color: var(--navy);
            text-align: left; padding: 16px;
            font-weight: 700; font-size: 0.85rem;
            text-transform: uppercase; letter-spacing: 0.5px;
            border-bottom: 2px solid #e2e8f0;
        }

        td { padding: 14px 16px; border-bottom: 1px solid #edf2f7; vertical-align: middle; }
        tr:hover td { background: #f7fafc; }

        /* --- Badges for Types --- */
        .badge {
            display: inline-block; padding: 4px 10px;
            border-radius: 20px; font-size: 0.75rem; font-weight: 700;
        }
        /* Specific Styles */
        .badge.protein { background: #ebf8ff; color: #2b6cb0; border: 1px solid #bee3f8; }
        .badge.mrna { background: #faf5ff; color: #805ad5; border: 1px solid #e9d8fd; } /* Purple for mRNA */
        .badge.mirna { background: #fffaf0; color: #dd6b20; border: 1px solid #feebc8; } /* Orange for miRNA */
        .badge.other { background: #edf2f7; color: #718096; }

        /* Typography */
        .name-cell { font-weight: 600; color: #2d3748; }
        .empty-cell { color: #cbd5e0; font-weight: 300; } /* Make '—' subtle */
        .species-cell { font-style: italic; color: #4a5568; }

        .status { text-align: center; padding: 40px; color: var(--text-light); }
        footer { text-align: center; padding: 20px; color: #a0aec0; font-size: 0.85rem; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo-box"><i class="fas fa-dna"></i></div>
        <h2>EVisionary</h2>
        <p>Integrated Proteomics & RNA Database</p>
    </div>

    <div class="search-area">
        <input type="text" id="q" placeholder="Search Gene, Protein (e.g. CD63), or Species..." autofocus>
        <button onclick="run()">Search</button>
    </div>

    <div class="container" id="results">
        <div class="status">
            <i class="fas fa-search fa-2x" style="opacity:0.2; margin-bottom:15px"></i>
            <p>Enter a query to harmonize data.</p>
        </div>
    </div>

    <footer>EVisionary &copy; 2026 | JEV Standardized Output</footer>

    <script>
        const qInput = document.getElementById('q');
        
        async function run() {
            const val = qInput.value.trim();
            if(!val) return;
            
            const box = document.getElementById('results');
            box.innerHTML = `<div class="status"><i class="fas fa-spinner fa-spin"></i> Searching...</div>`;

            try {
                const res = await fetch(`/search?q=${encodeURIComponent(val)}&limit=100`);
                const data = await res.json();

                if(data.length === 0) {
                    box.innerHTML = `<div class="status">No records found for "${val}".</div>`;
                    return;
                }

                let h = `
                <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Gene / Name</th>
                            <th>Species</th>
                            <th>Vesicle Type</th>
                            <th>Method</th>
                            <th>Year</th>
                        </tr>
                    </thead>
                    <tbody>`;
                
                data.forEach(r => {
                    // 1. Determine Badge Style
                    let bClass = 'other';
                    let txt = r.type; // e.g. "mRNA" from backend
                    
                    if(txt === 'Protein') bClass = 'protein';
                    else if(txt === 'mRNA') bClass = 'mrna';
                    else if(txt === 'miRNA') bClass = 'mirna';

                    // 2. Handle Empty Cells (Visual)
                    const show = (v, cls='') => v === '—' ? `<span class="empty-cell">—</span>` : `<span class="${cls}">${v}</span>`;

                    h += `
                    <tr>
                        <td><span class="badge ${bClass}">${txt}</span></td>
                        <td>${show(r.name, 'name-cell')}</td>
                        <td>${show(r.species, 'species-cell')}</td>
                        <td>${show(r.vesicle)}</td>
                        <td>${show(r.method)}</td>
                        <td>${show(r.year)}</td>
                    </tr>`;
                });

                h += `</tbody></table><div style="margin-top:10px; color:green; font-weight:bold; font-size:0.9rem">${data.length} records found</div>`;
                box.innerHTML = h;

            } catch(e) {
                box.innerHTML = `<div class="status" style="color:red">Error: ${e.message}</div>`;
            }
        }

        qInput.addEventListener('keypress', e => { if(e.key==='Enter') run() });
    </script>
</body>
</html>